// XHook - v0.1.0 - https://github.com/jpillora/xhook
// Â© Jaime Pillora <dev@jpillora.com> 2013
!function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[].slice,n=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=["open","setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader","overrideMimeType","addEventListener","removeEventListener","dispatchEvent"],d=["onreadystatechange","onprogress","onloadstart","onloadend","onload","onerror","onabort"],f=["readyState","responseText","statusText","status","response","responseType","responseXML","upload","withCredentials"],g=f[0],h=f[1],i=function(a){var b;return b=function(){},b.prototype=a,new b},l=function(a){return l.s.push(a)},l.s=[],j=function(b){var c;return(c=a[b])?a[b]=function(a){return"string"!=typeof a||/\.XMLHTTP/.test(a)?k(new c(a),c):void 0}:void 0},j("ActiveXObject"),j("XMLHttpRequest"),k=function(b){var h,j,k,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;for(q=!1,D={},C={withCredentials:!1},s={},t={},k={},j=function(a){var c,d,e;c={};for(d in a)e=a[d],c[d]=e===b?C:e;return c},w=i(k),B={},w.set=function(a,b){return q=!0,B[a]=1,C[a]=b},z={},w.setRequestHeader=function(a,c){return q=!0,z[a]=c,k.opened?b.setRequestHeader(a,c):void 0},A=i(t),w.setResponseHeader=function(a,b){return q=!0,A[a]=b},y={},x={},w.onChange=function(a,b){return q=!0,(y[a]=y[a]||[]).push(b)},w.onCall=function(a,b){return q=!0,(x[a]=x[a]||[]).push(b)},w.trigger=function(a,b){var c;return null==b&&(b={}),a=a.replace(/^on/,""),b.type=a,null!=(c=C["on"+a])?c.call(C,b):void 0},w.triggerComplete=function(){for(var a;C[g]<=4;)a=C[g]+1,w.set(g,a),w.trigger("readystatechange"),1===a&&w.trigger("loadstart"),4===a&&(w.trigger("load"),w.trigger("loadend"));return null},E=function(a){return C[a]=function(){var c,d,e,f,g,h,i,j,l,n;for(c=1<=arguments.length?m.call(arguments,0):[],h=c,e=x[a]||[],l=0,n=e.length;n>l;l++){if(d=e[l],i=d(c),i===!1)return;i&&(h=i)}switch(a){case"getAllResponseHeaders":f=[];for(g in A)j=A[g],f.push(""+g+":	"+j);return f.join("\n");case"send":k.data=h[0];break;case"open":k.method=h[0],k.url=h[1],k.async=h[2];break;case"setRequestHeader":if(s[h[0]]=h[1],z[h[0]])return}return k.opened=!k.opened&&"open"===a,k.sent=!k.sent&&"send"===a,b[a]?b[a].apply(b,h):void 0}},G=0,J=e.length;J>G;G++)p=e[G],E(p);for(u=function(){var a,c,d,e,g;try{for(g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(v(c,b[c]));return g}catch(h){if(a=h,"TypeError"===a.constructor.name)throw a}},v=function(a,d){var e,f,h,i,j,l,m,n,o,p,q,r,s,u;if(n=D[a],d!==n){if(D[a]=d,a===g){if(1===d)for(l in z)p=z[l],b.setRequestHeader(l,p);if(2===d)for(k.statusCode=b.status,j=b.getAllResponseHeaders().split("\n"),q=0,s=j.length;s>q;q++)i=j[q],h=/([^:]+):\s*(.*)/.test(i)?{k:RegExp.$1,v:RegExp.$2}:void 0,h&&!t[h.k]&&(t[h.k]=h.v)}for(f=y[a]||[],r=0,u=f.length;u>r;r++)e=f[r],o=e(d,n),o!==c&&(m=o);if(!B[a])return C[a]=m===c?d:m}},F=function(c){return b[c]=function(b){var d;return u(),b&&(d=j(b)),(a.E=a.E||[]).push(d),C[c]?C[c].call(C,d):void 0}},H=0,K=d.length;K>H;H++)o=d[H],F(o);u();for(r in b)if(C[r]===c&&n.call(d,r)<0)try{C[r]=b[r]}catch(N){}for(M=l.s,I=0,L=M.length;L>I;I++)h=M[I],h.call(null,w);return q?C:b},a.xhook=l}(window,document);