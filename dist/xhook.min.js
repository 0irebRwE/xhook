// XHook - v0.1.0 - https://github.com/jpillora/xhook
// Â© Jaime Pillora <dev@jpillora.com>  2013
!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=[].slice,p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=["open","setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader","overrideMimeType","addEventListener","removeEventListener","dispatchEvent"],d=["onreadystatechange","onprogress","onloadstart","onloadend","onload","onerror","onabort"],f=["readyState","responseText","withCredentials","statusText","status","response","responseType","responseXML","upload"],g=f[0],h=f[1],i=f[2],k=function(a){var b;return b=function(){},b.prototype=a,new b},n=function(a){return n.s.push(a)},n.s=[],j=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},n.headers=j,l=function(b){var c;return(c=a[b])?a[b]=function(a){return"string"!=typeof a||/\.XMLHTTP/.test(a)?m(new c(a),c):void 0}:void 0},l("ActiveXObject"),l("XMLHttpRequest"),m=function(b){var h,l,m,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;for(s=!1,F={},E={},E[i]=!1,u={},v={},m={},l=function(a){var c,d,e;c={};for(d in a)e=a[d],c[d]=e===b?E:e;return c},y=k(m),D={},y.set=function(a,c){var d;if(s=!0,D[a]=1,a===g){for(d=[];E[g]<c;)E[g]++,E[g]!==b[g]&&(y.set(g,E[g]),y.trigger("readystatechange"),1===E[g]&&y.trigger("loadstart"),4===E[g]?(y.trigger("load"),d.push(y.trigger("loadend"))):d.push(void 0));return d}return E[a]=c},B={},y.setRequestHeader=function(a,c){return s=!0,B[a]=c,m.opened?b.setRequestHeader(a,c):void 0},C=k(v),y.setResponseHeader=function(a,b){return s=!0,C[a]=b},A={},z={},y.onChange=function(a,b){return s=!0,(A[a]=A[a]||[]).push(b)},y.onCall=function(a,b){return s=!0,(z[a]=z[a]||[]).push(b)},y.trigger=function(a,b){var c;return null==b&&(b={}),a=a.replace(/^on/,""),b.type=a,null!=(c=E["on"+a])?c.call(E,b):void 0},y.triggerComplete=function(){return y.set(g,4),null},y.serialize=function(){var a,b,c,d;for(b={},c=0,d=f.length;d>c;c++)a=f[c],b[a]=E[a];return{method:m.method,url:m.url,async:m.async,body:m.body,responseHeaders:C,requestHeaders:B,props:b}},y.deserialize=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=["method","url","async","body"],f=0,g=h.length;g>f;f++)c=h[f],a[c]&&(y[c]=a[c]);i=a.responseHeaders||{};for(b in i)e=i[b],y.setResponseHeader(b,e);j=a.requestHeaders||{};for(b in j)e=j[b],y.setRequestHeader(b,e);k=a.props||{};for(d in k)e=k[d],y.set(d,e)},G=function(a){return E[a]=function(){var d,e,f,g,h,i,k;for(d=1<=arguments.length?o.call(arguments,0):[],g=d,f=z[a]||[],i=0,k=f.length;k>i;i++){if(e=f[i],h=e(d),h===!1)return console.log("cancel call ",a),void 0;h&&(g=h)}switch(a){case"getAllResponseHeaders":return j(C);case"send":m.body=g[0];break;case"open":m.method=g[0],m.url=g[1],m.async=g[2];break;case"setRequestHeader":if(u[g[0]]=g[1],B[g[0]]!==c)return}return m.opened=!m.opened&&"open"===a,m.sent=!m.sent&&"send"===a,b[a]?b[a].apply(b,g):void 0}},I=0,L=e.length;L>I;I++)r=e[I],G(r);for(w=function(){var a,c,d,e,g;try{for(g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(x(c,b[c]));return g}catch(h){if(a=h,"TypeError"===a.constructor.name)throw a}},x=function(a,d){var e,f,h,i,k,l,n,o,p;if(k=F[a],d!==k){if(F[a]=d,a===g){if(1===d)for(h in B)n=B[h],b.setRequestHeader(h,n);2===d&&(m.statusCode=b.status,j(b.getAllResponseHeaders(),v))}for(f=A[a]||[],o=0,p=f.length;p>o;o++)e=f[o],l=e(d,k),l!==c&&(i=l);if(!D[a])return E[a]=i===c?d:i}},H=function(c){return b[c]=function(b){var d;return w(),b&&(d=l(b)),(a.E=a.E||[]).push(d),E[c]?E[c].call(E,d):void 0}},J=0,M=d.length;M>J;J++)q=d[J],H(q);w();for(t in b)if(E[t]===c&&p.call(d,t)<0)try{E[t]=b[t]}catch(P){}for(O=n.s,K=0,N=O.length;N>K;K++)h=O[K],h.call(null,y);return s?E:b},console.log("public!"),a.xhook=n}(window,document);