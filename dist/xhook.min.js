// XHook - v0.1.0 - https://github.com/jpillora/xhook
// Â© Jaime Pillora <dev@jpillora.com> 2013
!function(a,b,c){var d,e,f,g,h,i,j,k=[].slice,l=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=["open","setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader","overrideMimeType","addEventListener","removeEventListener","dispatchEvent"],d=["onreadystatechange","onprogress","onloadstart","onloadend","onload","onerror","onabort"],f=["statusText","status","response","responseType","responseXML","responseText","upload","readyState","withCredentials"],g=function(a){var b;return b=function(){},b.prototype=a,new b},j=function(a){return j.s.push(a)},j.s=[],h=function(b){var c;return(c=a[b])?a[b]=function(a){return"string"!=typeof a||/\.XMLHTTP/.test(a)?i(new c(a),c):void 0}:void 0},h("ActiveXObject"),h("XMLHttpRequest"),i=function(a){var b,h,i,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(u={},t={withCredentials:!1},i={requestHeaders:{},responseHeaders:{}},r=g(i),r.callbacks=[],s=function(a,b){return(r.callbacks[a]||(r.callbacks[a]=[])).push(b)},r.onChange=function(a,b){return s("<:"+a,b)},r.onCall=function(a,b){return s(">:"+a,b)},v=function(b){return t[b]=function(){var c,d,e,f,g,h,j,l;switch(c=1<=arguments.length?k.call(arguments,0):[],b){case"send":i.data=c[0];break;case"open":i.method=c[0],i.url=c[1],i.async=c[2];break;case"setRequestHeader":i.requestHeaders[c[0]]=c[1]}if(f=c,e=r.callbacks[">:"+b])for(j=0,l=e.length;l>j;j++)d=e[j],g=d(c),g&&(f=g);return a[b]&&(h=a[b].apply(a,f)),h}},x=0,A=e.length;A>x;x++)n=e[x],v(n);for(p=function(){var b,c,d,e;try{for(e=[],c=0,d=f.length;d>c;c++)b=f[c],e.push(q(b,a[b]));return e}catch(g){}},q=function(b,d){var e,f,g,h,j,k,l,m,n,o,p,q;if(l=u[b],d!==l){if(u[b]=d,"readyState"===b&&2===d)for(i.statusCode=a.status,j=a.getAllResponseHeaders().split("\n"),n=0,p=j.length;p>n;n++)h=j[n],g=/([^:]+):\s*(.*)/.test(h)?{k:RegExp.$1,v:RegExp.$2}:void 0,g&&(i.responseHeaders[g.k]=g.v);if(f=r.callbacks["<:"+b])for(o=0,q=f.length;q>o;o++)e=f[o],m=e(d,l),m!==c&&(k=m);return t[b]=k===c?d:k}},h=function(b){var c,d,e;c={};for(d in b)e=b[d],c[d]=e===a?t:e;return c},w=function(b){return a[b]=function(a){var c;return p(),a&&(c=h(a)),t[b]?t[b].call(t,c):void 0}},y=0,B=d.length;B>y;y++)m=d[y],w(m);p();for(o in a)if(t[o]===c&&l.call(d,o)<0)try{t[o]=a[o]}catch(E){}for(D=j.s,z=0,C=D.length;C>z;z++)b=D[z],b.call(null,r);return t},a.xhook=j}(window,document);