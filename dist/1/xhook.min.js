// XHook - v1.1.0 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[].slice;n=a.document,c="before",b="after",j="readyState",g="Invalid number or parameters. Please see API documentation.",i="addEventListener",h="removeEventListener",f="dispatchEvent",l="XMLHttpRequest",k=["load","loadend","loadstart"],d=["progress","abort","error"],(p=Array.prototype).indexOf||(p.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),e=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={},b[i]=function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},b[h]=function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},b[f]=function(){var a,c,e,f,g,h,i,j;for(c=arguments[0],a=2<=arguments.length?q.call(arguments,1):[],f=b["on"+c],f&&f.apply(void 0,a),j=d(c),e=h=0,i=j.length;i>h;e=++h)g=j[e],g.apply(void 0,a)},a&&(b.listeners=function(a){return Array.prototype.slice.call(d(a))},b.on=b[i],b.off=b[h],b.fire=b[f]),b},o=e(!0),o[c]=function(a,b){return o[i](c,a,b)},o[b]=function(a,c){return o[i](b,a,c)},m=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},o.headers=m,o[l]=a[l],a[l]=function(){var a,h,i,p,q,r,s,t,u,v,w,x,y;return y=new o[l],v=!1,s=e(!0),s.headers={},t=null,x=function(){h.status=t.status,h.statusText=t.statusText,t.headers||(t.headers={})},w=function(){h.responseType=t.type||"",h.response=t.data||null,h.responseText=t.text||t.data||"",h.responseXML=t.xml||null},r=function(){var a,b,c,d;t.status=y.status,t.statusText=y.statusText,c=m(y.getAllResponseHeaders()),d=[];for(a in c)b=c[a],t.headers[a]?d.push(void 0):d.push(t.headers[a]=b);return d},q=function(){return t.type=y.responseType,t.text=y.responseText,t.data=y.response||t.text,t.xml=y.responseXML},a=0,u=function(c){var d,e,k;return d=function(){for(;c>a&&4>a;)h[j]=++a,2===a&&x(),4===a&&(x(),w()),h[f]("readystatechange",i("readystatechange")),4===a&&(h[f]("load",i("load")),h[f]("loadend",i("loadend")))},4>c?(d(),void 0):(e=o.listeners(b),k=function(){var a;if(!e.length)return d();if(a=e.shift(),2===a.length)return a(s,t),k();if(3===a.length)return a(s,t,k);throw g},k(),void 0)},i=function(a){var b;if(null!=n.createEventObject)return b=n.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},p=function(a,b,c){var d,e,g,h,i;for(e=function(a){return function(d){var e,g,h;e={};for(g in d)h=d[g],e[g]=h===b?c:h;return c[f](a,e)}},i=[],g=0,h=a.length;h>g;g++)d=a[g],i.push(b["on"+d]=e(d));return i},y.onreadystatechange=function(){try{2===y[j]&&r()}catch(a){}4===y[j]&&(v=!1,r(),q()),u(y[j])},h=e(),p(d,y,h),s.fire=h[f],h.withCredentials=!1,h.response=null,h.status=0,h.open=function(a,b,c,d,e){if(s.method=a,s.url=b,c===!1)throw"sync xhr not supported by XHook";s.user=d,s.pass=e,u(1)},h.send=function(a){var b,d,e;s.body=a,e=function(){var a,b,c;t={headers:{}},v=!0,y.open(s.method,s.url,!0,s.user,s.pass),y.timeout=s.timeout||h.timeout,c=s.headers;for(a in c)b=c[a],y.setRequestHeader(a,b);y.send(s.body)},b=o.listeners(c),d=function(){var a,c;if(!b.length)return e();if(a=function(a){return"object"==typeof a&&"number"==typeof a.status?(t=a,u(4),void 0):(d(),void 0)},c=b.shift(),1===c.length)return a(c(s));if(2===c.length)return c(s,a);throw g},d()},h.abort=function(){v&&y.abort(),h[f]("abort",arguments)},h.setRequestHeader=function(a,b){s.headers[a]=b},h.getResponseHeader=function(a){return t.headers[a]},h.getAllResponseHeaders=function(){return m(t.headers)},y.overrideMimeType&&(h.overrideMimeType=function(){return y.overrideMimeType.apply(y,arguments)}),y.upload&&(h.upload=e(),p(d.concat(k),y.upload,h.upload)),h},a.xhook=o}(this);