// XHook - v1.0.3 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=[].slice;e="before",d="after",h="readyState",g="Invalid number or parameters. Please see API documentation.",(n=Array.prototype).indexOf||(n.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),f=function(a){var b,d,e;return d={},e=function(a){return d[a]||[]},b={listeners:function(a){return Array.prototype.slice.call(e(a))},on:function(a,b,f){d[a]=e(a),d[a].indexOf(b)>=0||(f=f===c?d[a].length:f,d[a].splice(f,0,b))},off:function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},fire:function(){var b,c,d,f,g,h;for(c=arguments[0],b=2<=arguments.length?o.call(arguments,1):[],h=e(c),f=0,g=h.length;g>f;f++)d=h[f],d.apply(a,b)}}},l=f(),m={},m[e]=function(a,b){return l.on(e,a,b)},m[d]=function(a,b){return l.on(d,a,b)},i=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},m.headers=i,k=function(b){var c;c=a[b],c&&(a[b]=function(a){return"string"!=typeof a||/\.XMLHTTP/.test(a)?j(new c(a)):void 0})},k("ActiveXObject"),k("XMLHttpRequest"),j=function(a){var b,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(0===l.listeners(e).length&&0===l.listeners(d).length)return a;for(w=!1,t={headers:{}},u=null,q=f(),s=function(){p.status=u.status,p.statusText=u.statusText,u.headers||(u.headers={})},r=function(){p.responseType=u.type||"",p.response=u.data||null,p.responseText=u.text||u.data||"",p.responseXML=u.xml||null},k=function(){var b,c,d,e;u.status=a.status,u.statusText=a.statusText,d=i(a.getAllResponseHeaders()),e=[];for(b in d)c=d[b],u.headers[b]?e.push(void 0):e.push(u.headers[b]=c);return e},j=function(){return u.type=a.responseType,u.text=a.responseText,u.data=a.response||u.text,u.xml=a.responseXML},m=0,v=function(a){var b,c,e;return o(),b=function(){for(;a>m&&4>m;)p[h]=++m,2===m&&s(),4===m&&r(),q.fire("readystatechange"),4===m&&q.fire("load")},4>a?b():(c=l.listeners(d),e=function(){var a;if(!c.length)return b();if(a=c.shift(),2===a.length)return a(t,u),e();if(3===a.length)return a(t,u,e);throw g},e(),void 0)},b=function(b){var c,d,e;c={};for(d in b)e=b[d],c[d]=e===a?p:e;return c},o=function(){var b,d,e,f,g;for(g=["timeout"],e=0,f=g.length;f>e;e++)d=g[e],a[d]&&t[d]===c&&(t[d]=a[d]);for(d in p)b=p[d],"function"==typeof b&&/^on(\w+)/.test(d)&&q.on(RegExp.$1,b)},a.onreadystatechange=function(){try{2===a[h]&&(k(),v(2))}catch(b){}4===a[h]&&(w=!1,k(),j(),v(4))},z=["abort","progress"],x=0,y=z.length;y>x;x++)n=z[x],a["on"+n]=function(a){return q.fire(n,b(a))};return p={withCredentials:!1,response:null,status:0},p.addEventListener=function(a,b){return q.on(a,b)},p.removeEventListener=q.off,p.dispatchEvent=function(){},p.open=function(a,b,c){t.method=a,t.url=b,t.async=c,v(1)},p.send=function(b){var c,d,f;t.body=b,f=function(){var b,c,d;u={headers:{}},w=!0,a.open(t.method,t.url,t.async),t.timeout&&(a.timeout=t.timeout),d=t.headers;for(b in d)c=d[b],a.setRequestHeader(b,c);a.send(t.body)},c=l.listeners(e),d=function(){var a,b;if(!c.length)return f();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?d():(u=a,v(4),void 0)},b=c.shift(),1===b.length)return a(b(t));if(2===b.length)return b(t,a);throw g},d()},p.abort=function(){w&&a.abort(),q.fire("abort",arguments)},p.setRequestHeader=function(a,b){t.headers[a]=b},p.getResponseHeader=function(a){return u.headers[a]},p.getAllResponseHeaders=function(){return i(u.headers)},p.upload=f(),p},a.xhook=m}(window,document);