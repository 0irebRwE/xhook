// XHook - v1.1.0 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;n=a.document,d="before",c="after",j="readyState",i="addEventListener",h="removeEventListener",g="dispatchEvent",l="XMLHttpRequest",k=["load","loadend","loadstart"],e=["progress","abort","error","timeout"],(s=Array.prototype).indexOf||(s.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),p=function(a,b){var c,d;for(c in a)d=a[c],b[c]=d},q=function(a,b,c){var d,e,f,h;for(e=function(a){return function(d){var e,f,h;e={};for(f in d)h=d[f],e[f]=h===b?c:h;return c[g](a,e)}},f=0,h=a.length;h>f;f++)d=a[f],b["on"+d]=e(d)},o=function(a){var b;if(null!=n.createEventObject)return b=n.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},f=function(a){var c,d,e;return d={},e=function(a){return d[a]||[]},c={},c[i]=function(a,c,f){d[a]=e(a),d[a].indexOf(c)>=0||(f=f===b?d[a].length:f,d[a].splice(f,0,c))},c[h]=function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},c[g]=function(a,b){var d,f,g,h,i,j,k;for(d=o(a),p(b,d),g=c["on"+a],g&&g(d),k=e(a),f=i=0,j=k.length;j>i;f=++i)h=k[f],h(d)},a&&(c.listeners=function(a){return Array.prototype.slice.call(e(a))},c.on=c[i],c.off=c[h],c.fire=c[g]),c},r=f(!0),r[d]=function(a,b){if(a.length<1||a.length>2)throw"!";return r[i](d,a,b)},r[c]=function(a,b){if(a.length<2||a.length>3)throw"!";return r[i](c,a,b)},m=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},r.headers=m,r[l]=a[l],a[l]=function(){var a,h,n,s,t,u,v,w,x,y,z,A,B,C,D;D=new r[l],z=!1,w=f(!0),w.headers={},x={},x.headers={},v=function(){var a,b,c;x.status=D.status,x.statusText=D.statusText,c=m(D.getAllResponseHeaders());for(a in c)b=c[a],x.headers[a]||(x.headers[a]=b)},u=function(){x.type=D.responseType,x.type&&"document"!==x.type||(x.text=D.responseText,x.xml=D.responseXML),x.data=D.response||x.text},C=function(){n.status=x.status,n.statusText=x.statusText},B=function(){n.responseType=x.type||"",n.response=x.data||null,n.responseText=x.text||"",n.responseXML=x.xml||null},h=0,y=function(a){var b,d,e;return b=function(){for(;a>h&&4>h;)n[j]=++h,1===h&&n[g]("loadstart",o("loadstart")),2===h&&C(),4===h&&(C(),B()),n[g]("readystatechange",o("readystatechange")),4===h&&(n[g]("load",o("load")),n[g]("loadend",o("loadend")))},4>a?(b(),void 0):(d=r.listeners(c),e=function(){var a;return d.length?(a=d.shift(),2===a.length?(a(w,x),e()):3===a.length?a(w,x,e):void 0):b()},e(),void 0)},D.onreadystatechange=function(){try{2===D[j]&&v()}catch(a){}4===D[j]&&(z=!1,v(),u()),y(D[j])},n=f(),n[i]("progress",function(){return y(3)}),q(e,D,n),w.on=function(a,b){n[i](a,b)},w.fire=function(a,b){n[g](a,b)},n.withCredentials=!1,n.response=null,n.status=0,n.open=function(a,b,c,d,e){if(w.method=a,w.url=b,c===!1)throw"sync xhr not supported by XHook";w.user=d,w.pass=e,y(1)},n.send=function(a){var b,c,e;w.body=a,e=function(){var a,b,c,d,e,f,g;for(z=!0,D.open(w.method,w.url,!0,w.user,w.pass),f=["responseType","timeout"],d=0,e=f.length;e>d;d++)b=f[d],D[b]=w[b]||n[b];g=w.headers;for(a in g)c=g[a],D.setRequestHeader(a,c);D.send(w.body)},b=r.listeners(d),c=function(){var a,d;return b.length?(a=function(a){return"object"!=typeof a||"number"!=typeof a.status&&"number"!=typeof x.status?(c(),void 0):(p(a,x),y(4),void 0)},a.head=function(a){return p(a,x),y(2)},a.text=function(a){return x.text=a,y(3)},d=b.shift(),1===d.length?a(d(w)):2===d.length?d(w,a):void 0):e()},c()},n.abort=function(){z&&D.abort(),n[g]("abort",arguments)},n.setRequestHeader=function(a,b){w.headers[a]=b},n.getResponseHeader=function(a){return x.headers[a]},n.getAllResponseHeaders=function(){return m(x.headers)},D.overrideMimeType&&(n.overrideMimeType=function(){return D.overrideMimeType.apply(D,arguments)}),D.upload&&(n.upload=w.upload=f(),q(e.concat(k),D.upload,n.upload)),a=w.calls=f(!0),A=function(c,d){return function(){return a.fire(c,arguments),d.apply(b,arguments)}};for(t in n)s=n[t],"function"==typeof s&&(n[t]=A(t,s));return n},(this.define||Object)((this.exports||this).xhook=r)}(this);