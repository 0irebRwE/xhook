// XHook - v1.1.0 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].slice;m=a.document,c="before",b="after",i="readyState",h="addEventListener",g="removeEventListener",f="dispatchEvent",k="XMLHttpRequest",j=["load","loadend","loadstart"],d=["progress","abort","error","timeout"],(o=Array.prototype).indexOf||(o.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),e=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={},b[h]=function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},b[g]=function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},b[f]=function(){var a,c,e,f,g,h,i,j;for(c=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],f=b["on"+c],f&&f.apply(void 0,a),j=d(c),e=h=0,i=j.length;i>h;e=++h)g=j[e],g.apply(void 0,a)},a&&(b.listeners=function(a){return Array.prototype.slice.call(d(a))},b.on=b[h],b.off=b[g],b.fire=b[f]),b},n=e(!0),n[c]=function(a,b){if(a.length<1||a.length>2)throw"!";return n[h](c,a,b)},n[b]=function(a,c){if(a.length<2||a.length>3)throw"!";return n[h](b,a,c)},l=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},n.headers=l,n[k]=a[k],a[k]=function(){var a,g,h,o,p,q,r,s,t,u,v,w,x;return x=new n[k],u=!1,r=e(!0),r.headers={},s=null,w=function(){g.status=s.status,g.statusText=s.statusText,s.headers||(s.headers={})},v=function(){g.responseType=s.type||"",g.response=s.data||null,g.responseText=s.text||s.data||"",g.responseXML=s.xml||null},q=function(){var a,b,c,d;s.status=x.status,s.statusText=x.statusText,c=l(x.getAllResponseHeaders()),d=[];for(a in c)b=c[a],s.headers[a]?d.push(void 0):d.push(s.headers[a]=b);return d},p=function(){return s.type=x.responseType,s.text=x.responseText,s.data=x.response||s.text,s.xml=x.responseXML},a=0,t=function(c){var d,e,j;return d=function(){for(;c>a&&4>a;)g[i]=++a,1===a&&g[f]("loadstart",h("loadstart")),2===a&&w(),4===a&&(w(),v()),g[f]("readystatechange",h("readystatechange")),4===a&&(g[f]("load",h("load")),g[f]("loadend",h("loadend")))},4>c?(d(),void 0):(e=n.listeners(b),j=function(){var a;return e.length?(a=e.shift(),2===a.length?(a(r,s),j()):3===a.length?a(r,s,j):void 0):d()},j(),void 0)},h=function(a){var b;if(null!=m.createEventObject)return b=m.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},o=function(a,b,c){var d,e,g,h,i;for(e=function(a){return function(d){var e,g,h;e={};for(g in d)h=d[g],e[g]=h===b?c:h;return c[f](a,e)}},i=[],g=0,h=a.length;h>g;g++)d=a[g],i.push(b["on"+d]=e(d));return i},x.onreadystatechange=function(){try{2===x[i]&&q()}catch(a){}4===x[i]&&(u=!1,q(),p()),t(x[i])},g=e(),o(d,x,g),r.fire=g[f],g.withCredentials=!1,g.response=null,g.status=0,g.open=function(a,b,c,d,e){if(r.method=a,r.url=b,c===!1)throw"sync xhr not supported by XHook";r.user=d,r.pass=e,t(1)},g.send=function(a){var b,d,e;r.body=a,e=function(){var a,b,c;s={headers:{}},u=!0,x.open(r.method,r.url,!0,r.user,r.pass),x.timeout=r.timeout||g.timeout,c=r.headers;for(a in c)b=c[a],x.setRequestHeader(a,b);x.send(r.body)},b=n.listeners(c),d=function(){var a,c;return b.length?(a=function(a){return"object"==typeof a&&"number"==typeof a.status?(s=a,t(4),void 0):(d(),void 0)},c=b.shift(),1===c.length?a(c(r)):2===c.length?c(r,a):void 0):e()},d()},g.abort=function(){u&&x.abort(),g[f]("abort",arguments)},g.setRequestHeader=function(a,b){r.headers[a]=b},g.getResponseHeader=function(a){return s.headers[a]},g.getAllResponseHeaders=function(){return l(s.headers)},x.overrideMimeType&&(g.overrideMimeType=function(){return x.overrideMimeType.apply(x,arguments)}),x.upload&&(g.upload=e(),o(d.concat(j),x.upload,g.upload)),g},a.xhook=n}(this);