// XHook - v1.1.0 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a,b){var c,d,e,f,g,h,i,j,k,l,m=[].slice;d="before",c="after",g="readyState",f="Invalid number or parameters. Please see API documentation.",(l=Array.prototype).indexOf||(l.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),e=function(a){var c,d,e;return d={},e=function(a){return d[a]||[]},c={listeners:function(a){return Array.prototype.slice.call(e(a))},on:function(a,c,f){d[a]=e(a),d[a].indexOf(c)>=0||(f=f===b?d[a].length:f,d[a].splice(f,0,c))},off:function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},fire:function(){var b,c,d,f,g,h;for(c=arguments[0],b=2<=arguments.length?m.call(arguments,1):[],h=e(c),f=0,g=h.length;g>f;f++)d=h[f],d.apply(a,b)}}},j=e(),k={},k[d]=function(a,b){return j.on(d,a,b)},k[c]=function(a,b){return j.on(c,a,b)},i=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},k.headers=i,h=a.XMLHttpRequest,a.XMLHttpRequest=function(){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(z=new h,0===j.listeners(d).length&&0===j.listeners(c).length)return z;for(y=!1,v={headers:{}},w=null,r=e(),u=function(){q.status=w.status,q.statusText=w.statusText,w.headers||(w.headers={})},t=function(){q.responseType=w.type||"",q.response=w.data||null,q.responseText=w.text||w.data||"",q.responseXML=w.xml||null},m=function(){var a,b,c,d;w.status=z.status,w.statusText=z.statusText,c=i(z.getAllResponseHeaders()),d=[];for(a in c)b=c[a],w.headers[a]?d.push(void 0):d.push(w.headers[a]=b);return d},l=function(){return w.type=z.responseType,w.text=z.responseText,w.data=z.response||w.text,w.xml=z.responseXML},n=0,x=function(a){var b,d,e;return p(),b=function(){for(;a>n&&4>n;)q[g]=++n,2===n&&u(),4===n&&(u(),t()),r.fire("readystatechange",s("readystatechange")),4===n&&(r.fire("load",s("load")),r.fire("loadend",s("loadend")))},4>a?b():(d=j.listeners(c),e=function(){var a;if(!d.length)return b();if(a=d.shift(),2===a.length)return a(v,w),e();if(3===a.length)return a(v,w,e);throw f},e(),void 0)},s=function(b){var c;if(null!=a.document.createEventObject)return c=a.document.createEventObject(),c.type=b,c;try{return new Event(b)}catch(d){return{type:b}}},k=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d===z?q:d;return b},p=function(){var a,c,d,e,f;for(f=["timeout"],d=0,e=f.length;e>d;d++)c=f[d],z[c]&&v[c]===b&&(v[c]=z[c]);for(c in q)a=q[c],"function"==typeof a&&/^on(\w+)/.test(c)&&r.on(RegExp.$1,a)},z.onreadystatechange=function(){try{2===z[g]&&(m(),x(2))}catch(a){}4===z[g]&&(y=!1,m(),l(),x(4))},C=["abort","progress"],A=0,B=C.length;B>A;A++)o=C[A],z["on"+o]=function(a){return r.fire(o,k(a))};return q={withCredentials:!1,response:null,status:0},q.addEventListener=function(a,b){return r.on(a,b)},q.removeEventListener=r.off,q.dispatchEvent=function(){},q.open=function(a,b,c){v.method=a,v.url=b,v.async=c,x(1)},q.send=function(a){var b,c,e;v.body=a,e=function(){var a,b,c;w={headers:{}},y=!0,z.open(v.method,v.url,v.async),v.timeout&&(z.timeout=v.timeout),c=v.headers;for(a in c)b=c[a],z.setRequestHeader(a,b);z.send(v.body)},b=j.listeners(d),c=function(){var a,d;if(!b.length)return e();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?c():(w=a,x(4),void 0)},d=b.shift(),1===d.length)return a(d(v));if(2===d.length)return d(v,a);throw f},c()},q.abort=function(){y&&z.abort(),r.fire("abort",arguments)},q.setRequestHeader=function(a,b){v.headers[a]=b},q.getResponseHeader=function(a){return w.headers[a]},q.getAllResponseHeaders=function(){return i(w.headers)},q},a.xhook=k}(this);