// XHook - v1.1.0 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=[].slice;m=a.document,d="before",c="after",j="readyState",g="Invalid number or parameters. Please see API documentation.",i="addEventListener",h="removeEventListener",f="dispatchEvent",k="XMLHttpRequest",(o=Array.prototype).indexOf||(o.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),e=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={},b[i]=function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},b[h]=function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},b[f]=function(){var a,b,c,e,f,g,h;for(b=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],h=d(b),c=f=0,g=h.length;g>f;c=++f)e=h[c],console.log("FIRE",c,b),e.apply(void 0,a)},a&&(b.listeners=function(a){return Array.prototype.slice.call(d(a))},b.on=b[i],b.off=b[h],b.fire=b[f]),b},n=e(!0),n[d]=function(a,b){return n[i](d,a,b)},n[c]=function(a,b){return n[i](c,a,b)},l=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},n.headers=l,n[k]=a[k],a[k]=function(){var a,h,o,p,q,r,s,t,u,v,w,x,y,z,A;return A=new n[k],x=!1,u=e(!0),u.headers={},v=null,z=function(){q.status=v.status,q.statusText=v.statusText,v.headers||(v.headers={})},y=function(){q.responseType=v.type||"",q.response=v.data||null,q.responseText=v.text||v.data||"",q.responseXML=v.xml||null},t=function(){var a,b,c,d;v.status=A.status,v.statusText=A.statusText,c=l(A.getAllResponseHeaders()),d=[];for(a in c)b=c[a],v.headers[a]?d.push(void 0):d.push(v.headers[a]=b);return d},s=function(){return v.type=A.responseType,v.text=A.responseText,v.data=A.response||v.text,v.xml=A.responseXML},h=0,w=function(a){var b,d,e;return o(),b=function(){for(;a>h&&4>h;)q[j]=++h,console.log("READY STATE",q[j]),2===h&&z(),4===h&&(z(),y()),q[f]("readystatechange",r("readystatechange")),4===h&&(q[f]("load",r("load")),q[f]("loadend",r("loadend")))},4>a?(b(),void 0):(d=n.listeners(c),e=function(){var a;if(!d.length)return b();if(a=d.shift(),2===a.length)return a(u,v),e();if(3===a.length)return a(u,v,e);throw g},e(),void 0)},r=function(a){var b;if(null!=m.createEventObject)return b=m.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},a=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d===A?q:d;return b},p={},o=function(){var a,c,d,e,f,g;for(console.log("extract props..."),g=["timeout"],e=0,f=g.length;f>e;e++)d=g[e],A[d]&&u[d]===b&&(u[d]=A[d]);for(d in q)c=q[d],!p[d]&&"function"==typeof c&&/^on(\w+)/.test(d)&&(a=RegExp.$1,console.log("LISTEN FOR EVENT",a),q[i](a,c),p[d]=1)},A.onreadystatechange=function(){try{2===A[j]&&(t(),w(2))}catch(a){}4===A[j]&&(x=!1,t(),s(),w(4))},q=e(),q.withCredentials=!1,q.response=null,q.status=0,q.open=function(a,b){u.method=a,u.url=b,w(1)},q.send=function(a){var b,c,e;o(),u.body=a,e=function(){var a,b,c;v={headers:{}},x=!0,A.open(u.method,u.url),u.timeout&&(A.timeout=u.timeout),c=u.headers;for(a in c)b=c[a],A.setRequestHeader(a,b);A.send(u.body)},b=n.listeners(d),c=function(){var a,d;if(!b.length)return e();if(a=function(a){return"object"==typeof a&&"number"==typeof a.status?(v=a,w(4),void 0):(c(),void 0)},d=b.shift(),1===d.length)return a(d(u));if(2===d.length)return d(u,a);throw g},c()},q.abort=function(){x&&A.abort(),q[f]("abort",arguments)},q.setRequestHeader=function(a,b){u.headers[a]=b},q.getResponseHeader=function(a){return v.headers[a]},q.getAllResponseHeaders=function(){return l(v.headers)},A.overrideMimeType&&(q.overrideMimeType=function(){return A.overrideMimeType.apply(A,arguments)}),q},a.xhook=n}(this);