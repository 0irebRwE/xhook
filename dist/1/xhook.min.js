// XHook - v1.1.2 - https://github.com/jpillora/xhook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2014
!function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;n=a.document,d="before",c="after",j="readyState",i="addEventListener",h="removeEventListener",g="dispatchEvent",l="XMLHttpRequest",k=["load","loadend","loadstart"],e=["progress","abort","error","timeout"],(s=Array.prototype).indexOf||(s.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),p=function(a,b){var c,d;for(c in a){d=a[c];try{b[c]=d}catch(e){}}},q=function(a,b,c){var d,e,f,h;for(e=function(a){return function(d){var e,f,h;e={};for(f in d)h=d[f],e[f]=h===b?c:h;return c[g](a,e)}},f=0,h=a.length;h>f;f++)d=a[f],b["on"+d]=e(d)},o=function(a){var b;if(null!=n.createEventObject)return b=n.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},f=function(a){var c,d,e;return d={},e=function(a){return d[a]||[]},c={},c[i]=function(a,c,f){d[a]=e(a),d[a].indexOf(c)>=0||(f=f===b?d[a].length:f,d[a].splice(f,0,c))},c[h]=function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},c[g]=function(a,b){var d,f,g,h,i,j,k;for(d=o(a),p(b,d),g=c["on"+a],g&&g(d),k=e(a),f=i=0,j=k.length;j>i;f=++i)h=k[f],h(d)},a&&(c.listeners=function(a){return Array.prototype.slice.call(e(a))},c.on=c[i],c.off=c[h],c.fire=c[g]),c},r=f(!0),r.EventEmitter=f,r[d]=function(a,b){if(a.length<1||a.length>2)throw"invalid hook";return r[i](d,a,b)},r[c]=function(a,b){if(a.length<2||a.length>3)throw"invalid hook";return r[i](c,a,b)},m=r.headers=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},r[l]=a[l],a[l]=function(){var a,b,h,n,s,t,u,v,w,x,y;return y=new r[l],v=!1,s=f(!0),s.headers={},t={},t.headers={},n=function(){var a,b,c;t.status=y.status,t.statusText=y.statusText,c=m(y.getAllResponseHeaders());for(a in c)b=c[a],t.headers[a]||(t.headers[a]=b)},h=function(){try{t.text=y.responseText}catch(a){}try{t.xml=y.responseXML}catch(a){}t.data=y.response||t.text},x=function(){b.status=t.status,b.statusText=t.statusText},w=function(){b.response=t.data||t.text||null,b.responseText=t.text||"",b.responseXML=t.xml||null},a=0,u=function(d){var e,f,h;return e=function(){for(;d>a&&4>a;)b[j]=++a,1===a&&b[g]("loadstart",o("loadstart")),2===a&&x(),4===a&&(x(),w()),b[g]("readystatechange",o("readystatechange")),4===a&&(b[g]("load",o("load")),b[g]("loadend",o("loadend")))},4>d?(e(),void 0):(f=r.listeners(c),h=function(){var a;return f.length?(a=f.shift(),2===a.length?(a(s,t),h()):3===a.length?a(s,t,h):void 0):e()},h(),void 0)},y.onreadystatechange=function(){try{2===y[j]&&n()}catch(a){}4===y[j]&&(v=!1,n(),h()),u(y[j])},b=f(),b[i]("progress",function(){return u(3)}),q(e,y,b),s.on=function(a,c){b[i](a,c)},s.fire=function(a,c){b[g](a,c)},b.withCredentials=!1,b.response=null,b.status=0,b.open=function(a,b,c,d,e){if(s.method=a,s.url=b,c===!1)throw"sync xhr not supported by XHook";s.user=d,s.pass=e,u(1)},b.send=function(a){var c,e,f;s.body=a,f=function(){var a,c,d,e,f,g,h,i;for(v=!0,y.open(s.method,s.url,!0,s.user,s.pass),h=["type","timeout"],f=0,g=h.length;g>f;f++)c=h[f],d="type"===c?"responseType":c,y[d]=s[c]||b[d];i=s.headers;for(a in i)e=i[a],y.setRequestHeader(a,e);y.send(s.body)},c=r.listeners(d),e=function(){var a,b;return c.length?(a=function(a){return"object"!=typeof a||"number"!=typeof a.status&&"number"!=typeof t.status?(e(),void 0):(p(a,t),u(4),void 0)},a.head=function(a){return p(a,t),u(2)},a.text=function(a){return t.text=a,u(3)},b=c.shift(),1===b.length?a(b(s)):2===b.length?b(s,a):void 0):f()},e()},b.abort=function(){v&&y.abort(),b[g]("abort",arguments)},b.setRequestHeader=function(a,b){s.headers[a]=b},b.getResponseHeader=function(a){return t.headers[a]},b.getAllResponseHeaders=function(){return m(t.headers)},y.overrideMimeType&&(b.overrideMimeType=function(){return y.overrideMimeType.apply(y,arguments)}),b.upload=s.upload=f(),y.upload&&q(e.concat(k),y.upload,b.upload),b},(this.define||Object)((this.exports||this).xhook=r)}(this);